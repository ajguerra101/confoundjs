# confoundjs
An experiment in JavaScript obfuscation.

#### In short
`alert('Hello World');`

*becomes*

```
(function(ʃ){ʃ[+[]]=([]+{})[([+!+[]]+[+[]])>>!+[]]+([]+{})[+!+[]]+([][![]]+[])[
+!+[]]+(!{}+{})[+!+[]+!+[]+!+[]]+(!!{}+{})[+[]]+(!!{}+{})[+!+[]]+([][![]]+[])[+
[]]+([]+{})[([+!+[]]+[+[]])>>!+[]]+(!!{}+{})[+[]]+([]+{})[+!+[]]+(!!{}+{})[+!+[
]];ʃ[+!+[]]=[+[],([+!+[]+!+[]+!+[]]+[([+!+[]]+[+[]])-(!+[]+!+[]+!+[])]+[([+!+[]
]+[+[]])-!+[]]+[+!+[]+!+[]]+[+!+[]]+[([+!+[]]+[+[]])-!+[]])<<!+[],(([+!+[]]+[([
+!+[]]+[+[]])>>!+[]]+[+[]])-!+[])*(([+!+[]]+[+!+[]]+[+!+[]+!+[]]+[([+!+[]]+[+[]
])-!+[]]+[+!+[]+!+[]+!+[]])),((([+!+[]+!+[]+!+[]]+[+[]])<<!+[])-!+[])*(([+!+[]]
+[+!+[]]+[+[]]+[+[]]+[+[]])),(([+!+[]]+[+!+[]])<<!+[])*(([+!+[]+!+[]+!+[]]+[+!+
[]]+[+[]]+[+!+[]]+[([+!+[]]+[+[]])-(!+[]+!+[]+!+[])])),([+!+[]]+[+[]]+[+!+[]]+[
+!+[]]+[+!+[]]+[+!+[]]+[+!+[]]+[+[]]+[+!+[]+!+[]])/(([+!+[]]+[+!+[]+!+[]+!+[]+!
+[]]+[+[]])-!+[]),([([+!+[]]+[+[]])>>!+[]]+[([+!+[]]+[+[]])>>!+[]]+[([+!+[]]+[+
[]])-!+[]]+[+[]]+[+[]]+[+!+[]])-((([+!+[]]+[+[]])-!+[])<<!+[]),([+!+[]]+[([+!+[
]]+[+[]])-!+[]]+[([+!+[]]+[+[]])-!+[]]+[(!+[]+!+[]+!+[])<<!+[]]+[+!+[]+!+[]]+[+
[]]+[+[]])-((!+[]+!+[]+!+[])<<!+[])];ʃ[+!+[]+!+[]+!+[]]=function(Δ,ӣ,Ɣ,ᵷ,ѥ,ͽ,ϟ,
Չ,ʭ,ᴤ){for(ᵷ=+!!Δ,ʭ=[]+[],ᴤ=Δ[+![]];ᵷ<Δ[ʃ[+!+[]+!+[]]];ᵷ++){Չ=ϟ=Δ[ᵷ];ϟ=ϟ^ӣ;ͽ=(ᵷ
-Δ[ʃ[+!+[]+!+[]]]==+!Δ)?ᴤ:(+!+[]+!+[]+!+[]);for(ѥ=+!ӣ;ѥ<ͽ;ѥ++){ʭ+=ʃ[+([+!+[]]+[
+[]])]((ϟ&(((!+[]+!+[])<<((!+[]+!+[]+!+[])<<!+[]))-!+[]))+(!+[]<<(([+!+[]]+[+[]
])>>!+[])));ϟ=ϟ>>(([+!+[]]+[+[]])-(!+[]+!+[]+!+[]));}ӣ=(Չ>>(+!+[]+!+[]+!+[]))^ӣ
}(ᴤ==Δ[+![]]?Ɣ:ӣ)(ʭ);Δ=![]};ʃ[+!+[]+!+[]+!+[]+!+[]]=([+!+[]+!+[]+!+[]]+[([+!+[]
]+[+[]])>>!+[]]+[+!+[]+!+[]+!+[]]+[+!+[]+!+[]+!+[]]+[+!+[]+!+[]]+[(!+[]+!+[]+!+
[])<<!+[]]+[+!+[]+!+[]])>>!+[];ʃ[(!+[]+!+[]+!+[])<<!+[]]=function(){ʃ[([+!+[]]+
[+[]])-(!+[]+!+[]+!+[])]=(!!{}+{})[+[]]+([]+{})[+!+[]]+(((+![])+([]+[])[ʃ[+[]]]
)[(!{}+{})[+!+[]+!+[]+!+[]]+([][![]]+[])[+[]]+([]+{})[+!+[]+!+[]]+(!{}+{})[+!+[
]+!+[]+!+[]]+(!!{}+{})[+[]]+(!!{}+{})[+!+[]]](+([+!+[]]+[+[]]),(!+[]+!+[]+!+[])
<<!+[]));ʃ[([+!+[]]+[+[]])>>!+[]]=((!+[]<<(!+[]+!+[]+!+[]+!+[]))+!+[])[ʃ[([+!+[
]]+[+[]])-(!+[]+!+[]+!+[])]]((([+!+[]]+[+[]])-!+[])<<!+[]);ʃ[([+!+[]]+[+[]])-(!
+[]+!+[])]=(([+!+[]]+[+!+[]])<<!+[])[ʃ[([+!+[]]+[+[]])-(!+[]+!+[]+!+[])]]((([+!
+[]]+[+!+[]])<<!+[])+!+[]);ʃ[([+!+[]]+[+[]])-!+[]]=(+([+!+[]+!+[]+!+[]]+[+!+[]]
))[ʃ[([+!+[]]+[+[]])-(!+[]+!+[]+!+[])]](!+[]<<(([+!+[]]+[+[]])>>!+[]));ʃ[+!+[]+
!+[]]=(!{}+{})[+!+[]+!+[]]+(!!{}+{})[+!+[]+!+[]+!+[]]+([][![]]+[])[+!+[]]+(ʃ[([
+!+[]]+[+[]])-(!+[]+!+[]+!+[])])[([+!+[]]+[+[]])-(!+[]+!+[]+!+[])]+(!!{}+{})[+[
]]+(ʃ[([+!+[]]+[+[]])>>!+[]]);ʃ[+([+!+[]]+[+[]])]=([]+[])[ʃ[+[]]][(!{}+{})[+[]]
+(!!{}+{})[+!+[]]+([]+{})[+!+[]]+(ʃ[([+!+[]]+[+[]])-(!+[]+!+[])])+'C'+(ʃ[([+!+[
]]+[+[]])>>!+[]])+(!{}+{})[+!+[]]+(!!{}+{})[+!+[]]+'C'+([]+{})[+!+[]]+([][![]]+
[])[+!+[]+!+[]]+(!!{}+{})[+!+[]+!+[]+!+[]]];ʃ[+!+[]+!+[]+!+[]](ʃ[+!+[]],ʃ[+!+[]
+!+[]+!+[]+!+[]],(([][([]+{})[+!+[]+!+[]+!+[]]+([]+{})[+!+[]]+([][![]]+[])[([+!
+[]]+[+[]])>>!+[]]+([][![]]+[])[+!+[]]][ʃ[+[]]])((!!{}+{})[+!+[]]+(!!{}+{})[+!+
[]+!+[]+!+[]]+(!!{}+{})[+[]]+([][![]]+[])[+[]]+(!!{}+{})[+!+[]]+([][![]]+[])[+!
+[]]+([]+{})[([+!+[]]+[+[]])-(!+[]+!+[]+!+[])]+(!!{}+{})[+[]]+(ʃ[([+!+[]]+[+[]]
)>>!+[]])+([][![]]+[])[([+!+[]]+[+[]])>>!+[]]+(!{}+{})[+!+[]+!+[]+!+[]])())[(!!
{}+{})[+!+[]+!+[]+!+[]]+(ʃ[([+!+[]]+[+[]])-!+[]])+(!{}+{})[+!+[]]+(!{}+{})[+!+[
]+!+[]]])};ʃ[(!+[]+!+[]+!+[])<<!+[]]()})({});
```

### What is confoundjs
**confoundjs** is a JavaScript obfuscator inspired largely by [jsfuck](http://www.jsfuck.com/) [[GitHub](https://github.com/aemkei/jsfuck)].
**jsfuck**, whilst delivering on raw confusion/obfuscation, suffers from a catastrophically high encoding overhead.
**confoundjs** attempts to create a similarly confounding output, but with a much more reasonable overhead.

#### Side-by-side with jsfuck
+ **Mission Statement**
  + *jsfuck* aims to encode any possible JavaScript program using only 6 characters: `[]()!+`.
  + *confoundjs* loosens these restrictions in order to deliver a more efficient output. 

+ **Basic Construction**
  + *jsfuck* represents and evaluates the payload in one (very long) expression. The payload is constructed by concatanating character-by-character, with each character encoded individually using a *jsfuck* determined sub-expression.
  + *confoundjs* packs and encrypts the payload, and then builds an efficient representation of the packed payload. The output from *confoundjs* is bundled with a runtime unpacker/decrypter, which is responsible for extracting and evaluating the payload.

+ **Evaluation Speed**
  + *jsfuck* is stateless, and will therfore evaluate identical sub-expressions tens, hundreds or thousands of times.
  + *confoundjs* makes good use of state in order to generate outputs which are both efficient in size and in evaluation speed. The overhead to evaluate each packed block in the payload is the same (and quite small at that).

+ **Encoding Overhead: Constant and Scaling**
  + *jsfuck* requires around **1000** characters to encode an empty payload. Each character in the payload requires around **1700** characters to encode.
  + *confoundjs* requires around **2500** characters to encode an empty payload. Each character in the payload requires around **36** characters to encode.

+ **Encoding Speed**
  + *jsfuck* tends to be a faster encoder for smaller outputs. Larger outputs have a high string manipulation cost and can take quite some time to complete.
  + *confoundjs* is slower for smaller inputs, but scales linearly with payload size. The encoder must also perform a (relatively expensive) initialisation routine. This initialisation does not need to be repeated if multiple encodings are performed in one session.